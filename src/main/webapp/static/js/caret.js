!function(t,e){var n=document.createElement("input"),r="setSelectionRange"in n||"selectionStart"in n,a="createTextRange"in n||"selection"in document,o=/\r\n/g,i=/\r/g,c=function(e){return void 0!==e.value?e.value:t(e).text()},l=function(t,e){var n=c(t).replace(i,"").length;return void 0===e&&(e=n),(e=Math.floor(e))<0&&(e=n+e),e<0&&(e=0),e>n&&(e=n),e},s=function(t,e,n,r){this.start=t||0,this.end=e||0,this.length=n||0,this.text=r||""};s.prototype.toString=function(){return JSON.stringify(this,null,"    ")};var u=function(t){if(t)return r?function(t){return t.selectionStart}(t):a?function(t){var e,n,r,a,i;return t.focus(),t.focus(),(e=document.selection.createRange())&&e.parentElement()===t?(a=(r=c(t)).length,(n=t.createTextRange()).moveToBookmark(e.getBookmark()),(i=t.createTextRange()).collapse(!1),n.compareEndPoints("StartToEnd",i)>-1?r.replace(o,"\n").length:-n.moveStart("character",-a)):0}(t):void 0},g=function(t,e){t.focus(),e=l(t,e),r?function(t,e){t.setSelectionRange(e,e)}(t,e):a&&function(t,e){var n=t.createTextRange();n.move("character",e),n.select()}(t,e)},h=function(e,n){var r=u(e),a=c(e).replace(i,""),o=+(r+n.length+(a.length-r)),l=+e.getAttribute("maxlength");if(function(t,e){return t.hasAttribute?t.hasAttribute(e):void 0!==t[e]}(e,"maxlength")&&o>l){var s=n.length-(o-l);n=n.substr(0,s)}!function(e,n){void 0!==e.value?e.value=n:t(e).text(n)}(e,a.substr(0,r)+n+a.substr(r)),g(e,r+n.length)},f=function(t){if(t)return r?function(t){var e=new s;e.start=t.selectionStart,e.end=t.selectionEnd;var n=Math.min(e.start,e.end),r=Math.max(e.start,e.end);return e.length=r-n,e.text=c(t).substring(n,r),e}(t):a?function(t){var e=new s;t.focus();var n=document.selection.createRange();if(n&&n.parentElement()===t){var r,a,o,i,l=0,u=0,g=c(t);r=g.length,a=g.replace(/\r\n/g,"\n"),(o=t.createTextRange()).moveToBookmark(n.getBookmark()),(i=t.createTextRange()).collapse(!1),o.compareEndPoints("StartToEnd",i)>-1?l=u=r:(l=-o.moveStart("character",-r),l+=a.slice(0,l).split("\n").length-1,o.compareEndPoints("EndToEnd",i)>-1?u=r:(u=-o.moveEnd("character",-r),u+=a.slice(0,u).split("\n").length-1)),l-=g.substring(0,l).split("\r\n").length-1,u-=g.substring(0,u).split("\r\n").length-1,e.start=l,e.end=u,e.length=e.end-e.start,e.text=a.substr(e.start,e.length)}return e}(t):void 0},v=function(t,e,n){e=l(t,e),n=l(t,n),r?function(t,e,n){t.setSelectionRange(e,n)}(t,e,n):a&&function(t,e,n){var r=t.createTextRange();r.moveEnd("textedit",-1),r.moveStart("character",e),r.moveEnd("character",n-e),r.select()}(t,e,n)},d=function(e){var n=t(e);n.is("input, textarea")||e.select?n.select():r?function(t){var e=window.getSelection(),n=document.createRange();n.selectNodeContents(t),e.removeAllRanges(),e.addRange(n)}(e):a&&function(t){var e=document.body.createTextRange();e.moveToElementText(t),e.select()}(e)};t.extend(t.fn,{caret:function(){var t=this.filter("input, textarea");if(0===arguments.length){var e=t.get(0);return u(e)}if("number"==typeof arguments[0]){var n=arguments[0];t.each(function(t,e){g(e,n)})}else{var r=arguments[0];t.each(function(t,e){h(e,r)})}return this},range:function(){var e=this.filter("input, textarea");if(0===arguments.length){var n=e.get(0);return f(n)}if("number"==typeof arguments[0]){var r=arguments[0],a=arguments[1];e.each(function(t,e){v(e,r,a)})}else{var o=arguments[0];e.each(function(e,n){!function(e,n){var r=t(e),a=r.val(),o=f(e),i=+(o.start+n.length+(a.length-o.end)),c=+r.attr("maxlength");if(r.is("[maxlength]")&&i>c){var l=n.length-(i-c);n=n.substr(0,l)}var s=a.substr(0,o.start),u=a.substr(o.end);r.val(s+n+u);var g=o.start,h=g+n.length;v(e,o.length?g:h,h)}(n,o)})}return this},selectAll:function(){return this.each(function(t,e){d(e)})}}),t.extend(t,{deselectAll:function(){return document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),this}})}(window.jQuery||window.Zepto||window.$);